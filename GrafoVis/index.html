<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame
		Remove this if you use the .htaccess -->
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<title>Locomoção de Robôs - Grafo de Visibilidade</title>
		<meta name="description" content="" />
		<meta name="generator" content="Studio 3 http://aptana.com/" />
		<meta name="author" content="Igor" />
		<meta name="viewport" content="width=device-width; initial-scale=1.0" />
		<!-- Replace favicon.ico & apple-touch-icon.png in the root of your domain and delete these references -->
		<link rel="shortcut icon" href="/favicon.ico" />
		<link rel="apple-touch-icon" href="/apple-touch-icon.png" />

        <link type="text/css" href="css/dot-luv/jquery-ui-1.8.16.custom.css" rel="stylesheet" />	
		<script type="text/javascript" src="js/jquery-1.6.2.min.js"></script>
		<script type="text/javascript" src="js/jquery-ui-1.8.16.custom.min.js"></script>
		<script type="text/javascript" src="js/processing.js"> </script>
		<style>
			#robots {
				border: 1px solid;
				border-color: #000000;
			}
		</style>
		

		<script> 
			function complete_poly() {
				var p = Processing.getInstanceById("robots");
				p.finish_poly();
			}
			function set_start_point() {
				var p = Processing.getInstanceById("robots");
				p.set_mode("start_point");
			}
			
			function set_end_point() {
				var p = Processing.getInstanceById("robots");
				p.set_mode("end_point");
			}
			
			function start() {
				var p = Processing.getInstanceById("robots");
				p.start_algorithm();
			}

            function clear_state() {
				var p = Processing.getInstanceById("robots");
				p.clear_state();
                alert('asd');
            }
			
			function load_from_JSON(json_string) {
				var obj = JSON.parse(json_string);
				var p = Processing.getInstanceById("robots");
				p.set_start(obj['start']['x'], obj['start']['y']);
				p.set_end(obj['end']['x'], obj['end']['y']);
				var polys = obj['polygons'];
				for (var i = 0; i < polys.length; i++) {
					var poly = polys[i];
					for (var j = 0; j < poly.length; j++) {
						p.click_polys(poly[j]['x'], poly[j]['y']);
					}
					p.finish_poly();
				}
			}
			
			function load_last() {
				/*load_from_JSON('{\"start\": {\"x\" : 10, \"y\": 10}, \"end\": {\"x\" : 300, \"y\": 300}, ' + 
					' \"polygons\" : [ [{\"x\" : 20, \"y\" : 20}, {\"x\" : 30, \"y\" : 10}, {\"x\" : 30, \"y\" : 30}] ]  }');*/
					
				//load_from_JSON('{\"start\":{\"x\":10,\"y\":10},\"end\":{\"x\":300,\"y\":300},"polygons":[[{\"x\":20,\"y\":20},{\"x\":30,\"y\":10},{\"x\":30,\"y\":30}],[{\"x\":206,\"y\":108},{\"x\":206,\"y\":152},{\"x\":355,\"y\":97}]]}');
				if (localStorage['last'] != "undefined" && localStorage['last'] != "" && localStorage['last'] != null &&
					localStorage['last'] != undefined) {
					load_from_JSON(localStorage['last']);
				} else {
					load_from_JSON("{\"start\":{\"x\":11,\"y\":108},\"end\":{\"x\":472,\"y\":335},\"polygons\":[[{\"x\":44,\"y\":59},{\"x\":44,\"y\":180},{\"x\":220,\"y\":252},{\"x\":375,\"y\":54}],[{\"x\":348,\"y\":191},{\"x\":245,\"y\":379},{\"x\":440,\"y\":472},{\"x\":467,\"y\":151}],[{\"x\":122,\"y\":232},{\"x\":26,\"y\":414},{\"x\":217,\"y\":476}]]}");
				}
                $("#load_dialog").dialog('open');
			}
			
			function save_to_JSON(key) {
				var obj = {};
				var p = Processing.getInstanceById("robots");
				var start = p.get_start();
				obj['start'] = {"x" : start.x, "y" : start.y};
				var end = p.get_end();
				obj['end'] = {"x" : end.x, "y" : end.y};
				obj['polygons'] = [];
				var polys = p.get_polys();
				for(var i = 0; i < polys.size(); i++) {
					var poly_p5 = polys.get(i).points;
					var poly = [];
					for(var j = 0; j < poly_p5.size(); j++) {
						poly.push({"x": poly_p5.get(j).x, "y": poly_p5.get(j).y});
					}	
					obj['polygons'].push(poly);
				}
				localStorage[key] = JSON.stringify(obj); 
			}

            $(function () {
                $("#load_dialog").dialog({
                    autoOpen: false
                });

                $("#complete_polygon, #set_start_point, #set_end_point, #start_btn, #load_btn, #save_btn, #clear_btn").button();
            });

		</script>
	</head>
	<body>
	    <header>
		    <h1>Locomoção de Robôs - Grafo de Visibilidade</h1>
	    </header>
		<div>
			<input type="button" id="complete_polygon" value="Complete Polygon" onclick="complete_poly()"/>
			<input type="button" id="set_start_point" value="Set start point" onclick="set_start_point()" />
			<input type="button" id="set_end_point" value="Set end point" onclick="set_end_point()" />
			<input type="button" id="start_btn" value="Start!" onclick="start()" />
			<input type="button" id="load_btn" value="Load" onclick="load_last();" />
			<input type="button" id="save_btn" value="Save" onclick="save_to_JSON('last');" />
            <input type="button" id="clear_btn" value="Clear" onclick="clear_state();" />
			<br>
			<canvas data-processing-sources="data_structures.pde polygons.pde sort.pde graph_vis_animation.pde dijkstra.pde main.pde" id="robots"></canvas>
		</div>	
        <div id="load_dialog" title="Saved simulations">
            
        </div>
		<footer>
			<p>
				&copy; Copyright 2011 by Igor
			</p>
		</footer>
	</body>
</html>
